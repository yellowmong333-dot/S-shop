<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SFOODGO</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="topbar">SFOODGO</div>
  <main class="grid" id="list"></main>
  <div class="modal" id="modal" aria-hidden="true">
    <img id="modalImg" alt="상세 이미지" />
  </div>
  <script>
    function clThumb(url, w=851, h=315) {
      if (!url || !url.includes('/upload/')) return url;
      return url.replace('/upload/', `/upload/c_pad,w_${w},h_${h},b_white,q_auto,f_auto/`);
    }
    function clDetail(url, maxW=1400) {
      if (!url || !url.includes('/upload/')) return url;
      return url.replace('/upload/', `/upload/q_auto,f_auto,w_${maxW},c_fit/`);
    }
    async function load() {
      const res = await fetch('/data.json?ts=' + Date.now());
      const data = await res.json();
      const list = document.getElementById('list');
      list.innerHTML = '';
      (data.items || []).forEach(item => {
        const card = document.createElement('a');
        card.href = 'javascript:void(0)';
        card.className = 'item-card';
        card.onclick = () => openDetail(item.detailUrl || item.mainUrl);
        const img = document.createElement('img');
        img.className = 'item-img';
        img.src = clThumb(item.mainUrl);
        const name = document.createElement('div');
        name.className = 'item-name';
        name.textContent = item.name || '상품';
        card.appendChild(img);
        card.appendChild(name);
        list.appendChild(card);
      });
    }
    function openDetail(url) {
      const m = document.getElementById('modal');
      const mi = document.getElementById('modalImg');
      mi.src = clDetail(url || '');
      m.classList.add('open');
    }
    document.getElementById('modal').addEventListener('click', e => {
      if (e.target.id === 'modal' || e.target.id === 'modalImg') {
        e.currentTarget.classList.remove('open');
      }
    });
    load();
  </script>
</body>
</html>
